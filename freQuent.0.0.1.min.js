/* freQuent.0.0.1 (2013-05-20) https://github.com/solygen/freQuent */require(["view-calendar","view-tags"],function(e,n){"use strict";window.console===void 0&&(window.console={log:$.noop,debug:$.noop,error:$.noop,warn:$.noop}),require.config({waitSeconds:2}),$(document).ready(function(){var t=function(){"#"===location.hash.substr(0,1)?"#calendar"===location.hash?e.render():n.render():e.render()};window.onhashchange=t,t()})}),define(["prototype"],function(e){"use strict";return e.use(),{balance:{day:(new Date).toIso(),amount:3357},puffer:1e3}}),define([],function(){"use strict";return[{id:"a",icon:"",name:"Income",amount:2e3,category:"income",tags:["income"],targets:["01.01.","01.02.","01.03.","01.04.","01.05.","01.06.","01.07.","01.08.","01.09.","01.10.","01.11.","01.12."]},{id:1,icon:"icon-fire",name:"1 2 3 energie",amount:-150,category:"consume",tags:["gas"],targets:["16.01.","16.02.","16.03.","16.04.","16.05.","16.06.","16.07.","16.08.","16.09.","16.10.","16.11.","16.12."]},{id:2,icon:"icon-bolt",name:"eprimo",amount:-50,category:"consume",tags:["electricity"],targets:["01.01.","01.02.","01.03.","01.04.","01.05.","01.06.","01.07.","01.08.","01.09.","01.10.","01.11.","01.12."]},{id:6,icon:"icon-home",name:"bank",amount:-200,category:"credit",tags:["house"],targets:["01.01.","01.04.","01.07.","01.10."]},{id:34,icon:"icon-beer",name:"Club",amount:-25,category:"club",tags:["house"],targets:["25.03."]}]}),define([],function(){"use strict";var e={getWeekday:function(e){switch(e="string"===$.type(e)?this.getDate(e):e,e.getDay()){case 0:return"Sunday";case 1:return"Monday";case 2:return"Thursday";case 3:return"Wednesday";case 4:return"Thursday";case 5:return"Friday";case 6:return"Saturday"}},getMonth:function(e){switch(e="string"===$.type(e)?this.getDate(e):e,e.getUTCMonth()){case 0:return"January";case 1:return"Feburary";case 2:return"March";case 3:return"April";case 4:return"May";case 5:return"June";case 6:return"July";case 7:return"August";case 8:return"September";case 9:return"October";case 10:return"November";case 11:return"December"}},getDate:function(e){return new Date(e)},getPayingDate:function(e){return e="string"===$.type(e)?this.getDate(e):e,"Saturday"===this.getWeekday(e)?e.setDate(e.getDate()+2):"Sunday"===this.getWeekday(e)&&e.setDate(e.getDate()+1),e},getDateKey:function(e){var n=e.split("."),t=(new Date).getFullYear()+"-"+n[1]+"-"+n[0],a=this.getPayingDate(t);return a.toIso()},getRetroKey:function(e){var n=new Date(e);return n.setDate(n.getDate()-21),n.toIso()},getNowKey:function(){return(new Date).toIso()}};return e}),define([],function(){"use strict";return{use:function(){Date.prototype.toIso=Date.prototype.toIso||function(){var e=this.getDate(),n=this.getMonth()+1,t=this.getFullYear();return e=10>e?"0"+e:e,n=10>n?"0"+n:n,t+"-"+n+"-"+e}}}}),define(["data","date","config"],function(e,n,t){"use strict";var a=$.extend({calendar:{},current:{},setBalance:function(e){a.level=e,a.balancemin=a.balancemin===void 0||a.balancemin>e?e:a.balancemin},getService:function(n){var t=_.filter(e,function(e){return e.id===n});return _.first(t)},numberFormat:function(e){return e.toFixed(2).replace(".",",").toLocaleString()},getRow:function(e,n,t,r){var o=$("<div>").addClass("row-fluid"),c=$("<div>").addClass("span2").text(a.numberFormat(Math.round(e))||""),s=$("<div>").addClass("span2").text(a.numberFormat(n)),d=$("<div>").addClass("span7").text(t),u=$("<div>").addClass("span1").append($("<i>").addClass(r||"").addClass("iconx"));return 0>n?(u.css("background-color","#FF3333"),c.css("background-color","#FF3333"),s.css("background-color","#EE0000"),d.css("background-color","#FF3333")):(u.css("background-color","#CDE472"),c.css("background-color","#CDE472"),s.css("background-color","#CECC15"),d.css("background-color","#CDE472")),e||(u.css("background-color","Snow"),c.css("background-color","Snow"),s.css("background-color","Snow"),d.css("background-color","Snow")),o.append(u,c,s,d)},insertMonth:function(e){var t=n.getMonth(e),r=(a.current.month||"")===t;return a.current.month=t,r?"":$("<h1>").text(t).css("padding-top","48px")},renderContent:function(){var e=$("<div>"),t=a.calendar,r=Object.keys(t).sort();return _.each(r,function(r){r>=n.getRetroKey(a.balance.day)&&(e.append(a.insertMonth(r)),e.append($("<h3>").text(n.getWeekday(r)+", "+n.getDate(r).getUTCDate()+".")),t[r]=_.sortBy(t[r],function(e){var n=a.getService(e);return-1*Math.abs(n.amount)}),_.each(t[r],function(n){var t=a.getService(n);r>=a.balance.day?(a.setBalance(a.balance.amount+t.amount),e.append($("<p>").append(a.getRow(a.balance.amount,t.amount,t.name,t.icon)))):e.append($("<p>").append(a.getRow(null,t.amount,t.name,t.icon)))}))}),e},addToCalendar:function(e){_.each(e.targets,function(t){var r=n.getDateKey(t),o=a.calendar[r]=a.calendar[r]||[];o.push(e.id)})},render:function(){$($.find("#current")).text("current: "+Math.round(a.balance.amount)),$($.find("#puffer")).text("puffer: "+Math.round(a.puffer));var n={costs:0,income:0};_.map(e,function(e){return 0>e.amount?n.costs=n.costs+e.amount*e.targets.length/12:n.income=n.income+e.amount*e.targets.length/12,a.addToCalendar(e)}),$($.find("#title")).text("Calendar");var t=a.renderContent();$($.find("#content")).html(t),$($.find("#min")).text("min: "+Math.round(a.balancemin||a.balance.amount)),n.costs=Math.round(n.costs),n.income=Math.round(n.income),$($.find("#monthly")).empty().append("monthly: ").append("<br>").append($("<i>").addClass("icon-arrow-down").css("padding-right",20)).append(-1*n.costs).append("<br>").append($("<i>").addClass("icon-arrow-up").css("padding-right",20)).append(n.income).append("<br>").append($("<i>").addClass("icon-chevron-right").css("padding-right",20)).append(n.income+n.costs),a.calendar={},a.current={}}},t);return a}),define(["data","date","config"],function(e,n,t){"use strict";var a=$.extend({calendar:{},current:{},setBalance:function(e){a.level=e,a.balancemin=a.balancemin===void 0||a.balancemin>e?e:a.balancemin},getService:function(n){var t=_.filter(e,function(e){return e.id===n});return _.first(t)},numberFormat:function(e){return e.toFixed(2).replace(".",",").toLocaleString()},getRow:function(e,n,t,r){var o=$("<div>").addClass("row-fluid"),c=$("<div>").addClass("span2").text(a.numberFormat(Math.round(e))||""),s=$("<div>").addClass("span2").text(a.numberFormat(n)),d=$("<div>").addClass("span7").text(t),u=$("<div>").addClass("span1").append($("<i>").addClass(r||"").addClass("iconx"));return 0>n?(u.css("background-color","#FF3333"),c.css("background-color","#FF3333"),s.css("background-color","#EE0000"),d.css("background-color","#FF3333")):(u.css("background-color","#CDE472"),c.css("background-color","#CDE472"),s.css("background-color","#CECC15"),d.css("background-color","#CDE472")),e||(u.css("background-color","Snow"),c.css("background-color","Snow"),s.css("background-color","Snow"),d.css("background-color","Snow")),o.append(u,c,s,d)},insertMonth:function(e){var t=n.getMonth(e),r=(a.current.month||"")===t;return a.current.month=t,r?"":$("<h1>").text(t).css("padding-top","48px")},renderContent:function(){var e=$("<div>"),t=a.calendar,r=Object.keys(t).sort();return _.each(r,function(r){r>=n.getRetroKey(a.balance.day)&&(e.append(a.insertMonth(r)),e.append($("<h3>").text(n.getWeekday(r)+", "+n.getDate(r).getUTCDate()+".")),t[r]=_.sortBy(t[r],function(e){var n=a.getService(e);return-1*Math.abs(n.amount)}),_.each(t[r],function(n){var t=a.getService(n);r>=a.balance.day?(a.setBalance(a.balance.amount+t.amount),e.append($("<p>").append(a.getRow(a.balance.amount,t.amount,t.name,t.icon)))):e.append($("<p>").append(a.getRow(null,t.amount,t.name,t.icon)))}))}),e},addToCalendar:function(e){_.each(e.targets,function(t){var r=n.getDateKey(t),o=a.calendar[r]=a.calendar[r]||[];o.push(e.id)})},render:function(){var n={costs:0,income:0};_.map(e,function(e){return 0>e.amount?n.costs=n.costs+e.amount*e.targets.length/12:n.income=n.income+e.amount*e.targets.length/12,a.addToCalendar(e)}),$($.find("#title")).text("Tags"),$($.find("#content")).html(""),$($.find("#monthly")).empty(),a.calendar={},a.current={}}},t);return a});